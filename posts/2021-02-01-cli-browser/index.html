<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>cliBrowser | fernetInjection</title><meta name=description content="We are fernetInjection, a CTF team from Argentina ðŸ‡¦ðŸ‡·. Here you can find our write-ups and reflections."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="cliBrowser"><meta property="og:description" content="First impressions and reversing This challenge consisted of a hint:
 Man I am so tired of that cringe web stack, it&rsquo;s such a joke. So I made my web app in the cli, because what&rsquo;s better than fancy terminal
 And a binary named client that upon execution printed a banner (very cool btw) and displayed a prompt.
I started by entering some random input and got back invalid input provided, so the logical step was to search for this string."><meta property="og:type" content="article"><meta property="og:url" content="https://fernetinjection.github.io/posts/2021-02-01-cli-browser/"><meta property="article:published_time" content="2021-02-01T09:00:00+00:00"><meta property="article:modified_time" content="2021-02-01T09:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="cliBrowser"><meta name=twitter:description content="First impressions and reversing This challenge consisted of a hint:
 Man I am so tired of that cringe web stack, it&rsquo;s such a joke. So I made my web app in the cli, because what&rsquo;s better than fancy terminal
 And a binary named client that upon execution printed a banner (very cool btw) and displayed a prompt.
I started by entering some random input and got back invalid input provided, so the logical step was to search for this string."><link rel=stylesheet href=https://fernetinjection.github.io/css/style-dark.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://fernetinjection.github.io/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a><a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a><a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast');" style=display:none><i class="fas fa-chevron-up fa-lg"></i></a><span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://fernetinjection.github.io/posts/2021-02-01-echo/><i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li><li><a class=icon href=https://fernetinjection.github.io/posts/2021-02-02-encryptor/><i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li><li><a class=icon href=#><i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f"><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&text=cliBrowser"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&title=cliBrowser"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&is_video=false&description=cliBrowser"><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=cliBrowser&body=Check out this article: https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f"><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&title=cliBrowser"><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&title=cliBrowser"><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&title=cliBrowser"><i class="fab fa-stumbleupon" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&title=cliBrowser"><i class="fab fa-digg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&name=cliBrowser&description=First%20impressions%20and%20reversing%20This%20challenge%20consisted%20of%20a%20hint%3a%0a%20Man%20I%20am%20so%20tired%20of%20that%20cringe%20web%20stack%2c%20it%26rsquo%3bs%20such%20a%20joke.%20So%20I%20made%20my%20web%20app%20in%20the%20cli%2c%20because%20what%26rsquo%3bs%20better%20than%20fancy%20terminal%0a%20And%20a%20binary%20named%20client%20that%20upon%20execution%20printed%20a%20banner%20%28very%20cool%20btw%29%20and%20displayed%20a%20prompt.%0aI%20started%20by%20entering%20some%20random%20input%20and%20got%20back%20invalid%20input%20provided%2c%20so%20the%20logical%20step%20was%20to%20search%20for%20this%20string."><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&t=cliBrowser"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#first-impressions-and-reversing>First impressions and reversing</a></li><li><a href=#intercepting-network-traffic>Intercepting network traffic</a></li><li><a href=#so-what-are-jwts-anyway>So what are JWTs anyway?</a></li><li><a href=#profit>Profit</a></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">cliBrowser</h1><div class=meta><div class=postdate><time datetime="2021-02-01 09:00:00 +0000 UTC" itemprop=datePublished>2021-02-01</time></div><div class=article-category><i class="fas fa-archive"></i><a class=category-link href=/categories/ctf>CTF</a></div><div class=article-tag><i class="fas fa-tag"></i><a class=tag-link href=/tags/reverse_engineering rel=tag>Reverse_Engineering</a>
<a class=tag-link href=/tags/ctf_0x41414141 rel=tag>CTF_0x41414141</a>
<a class=tag-link href=/tags/jwt rel=tag>JWT</a>
<a class=tag-link href=/tags/go_reversing rel=tag>Go_Reversing</a></div></div></header><div class=content itemprop=articleBody><h2 id=first-impressions-and-reversing>First impressions and reversing</h2><p>This challenge consisted of a hint:</p><blockquote><p>Man I am so tired of that cringe web stack, it&rsquo;s such a joke.
So I made my web app in the cli, because what&rsquo;s better than fancy terminal</p></blockquote><p>And a binary named <code>client</code> that upon execution printed a banner (very cool btw) and displayed a prompt.</p><p>I started by entering some random input and got back <code>invalid input provided</code>, so the logical step was to search for this string.
I jumped into IDA but I couldn&rsquo;t find it in the strings subview and, in the process, observed that the binary was rather complex.
This made me suspect that I wasn&rsquo;t dealing with a binary written in C and using <code>file</code> I learned that it was a Go binary:</p><pre><code>$ file client
client: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, Go BuildID=KzYxyAuY9brNuX9NUS2u/ym8cURI9XeMgdiUoZr5J/DKah0rAnpfyTzOgMU17e/c5XvA9s2PmKZA8gTeXuL, not stripped
</code></pre><p>However, I could find the text <code>invalid input provided</code> using the &ldquo;sequence of bytes&rdquo; search option and it appeared that all strings were concatenated together as one long string that IDA failed to recognize.</p><p><img src=../../images/posts/cliBrowser/00_strings.png alt=output></p><p>It turns out that in Go, strings are not stored as null-terminated strings in the compiled binary. They are concatenated one after the other in the <code>.rodata</code> section. Each sequence of bytes is pointed from a struct that also contains the string length. This was the struct that I defined:</p><p><img src=../../images/posts/cliBrowser/01_struct.png alt=output></p><p>It was referenced by a function called <code>main_get_input</code> which was kind of complicated xD</p><p><img src=../../images/posts/cliBrowser/02_funcion.png alt=output></p><p>But I found that it compared some backward strings like exit or help.</p><p><img src=../../images/posts/cliBrowser/03_help.png alt=output></p><p>And entering help as input printed a menu that displayed the valid inputs:</p><pre><code>âžœ help
help page :
- login 
- hello 
- ping
- flag
- exit
</code></pre><p>However, there was one more string in the function that was not listed in the help menu: <code>secret</code>. When used as input the binary printed a string that appeared to be some kind of easter egg.</p><pre><code>âžœ secret
0x41414141 is 1337
</code></pre><h2 id=intercepting-network-traffic>Intercepting network traffic</h2><p>The name of the binary, the options displayed, and the hint suggested that the binary was just an interface for some API. So I decided to use the program while listening to the network traffic using Wireshark.</p><p>I tried to log in as admin and get the flag but failed. Then, I repeated the process with a random user but failed again with a different error. However, the packets captured revealed some interesting information:</p><pre><code>POST /login HTTP/1.1
Host: 161.97.176.150:6666
User-Agent: Go-http-client/1.1
Content-Length: 29
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip

password=admin&amp;username=admin

HTTP/1.1 401 Unauthorized
Content-Type: application/json; charset=utf-8
Www-Authenticate: JWT realm=test zone
Date: Mon, 25 Jan 2021 16:24:30 GMT
Content-Length: 55

{&quot;code&quot;:401,&quot;message&quot;:&quot;incorrect Username or Password&quot;}

GET /auth/flag HTTP/1.1
Host: 161.97.176.150:6666
User-Agent: Go-http-client/1.1
Authorization: Bearer
Accept-Encoding: gzip

HTTP/1.1 401 Unauthorized
Content-Type: application/json; charset=utf-8
Www-Authenticate: JWT realm=test zone
Date: Mon, 25 Jan 2021 16:24:32 GMT
Content-Length: 46

{&quot;code&quot;:401,&quot;message&quot;:&quot;cookie token is empty&quot;}
</code></pre><p>When I tried to log in as admin the binary made a <code>POST</code> request to <code>/login</code>, but the response code was <code>401</code>. A <code>GET</code> request was made to <code>/auth/flag</code> when I tried to retrieve the flag and, again, the response was a <code>401</code>. It called my attention that the Authorization header was set in the request but there was no token and both responses had the www-Authenticate header type set to JWT. Now comes the interesting part. When I logged in as a random user, I got back a token and, when requested the flag, the response code changed to <code>200</code>:</p><pre><code>
POST /login HTTP/1.1
Host: 161.97.176.150:6666
User-Agent: Go-http-client/1.1
Content-Length: 27
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip

password=test&amp;username=test

HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
Date: Mon, 25 Jan 2021 16:09:50 GMT
Content-Length: 211

{&quot;code&quot;:200,&quot;expire&quot;:&quot;2021-01-25T18:09:50+01:00&quot;,&quot;token&quot;:&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2MTE1OTQ1OTAsImlkIjoidGVzdCIsIm9yaWdfaWF0IjoxNjExNTkwOTkwfQ.NmQ-N0hqJaY4NtjGJdJm1XFlsozyt-tB4CYLdtL4QoM&quot;}

GET /auth/flag HTTP/1.1
Host: 161.97.176.150:6666
User-Agent: Go-http-client/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2MTE1OTQ1OTAsImlkIjoidGVzdCIsIm9yaWdfaWF0IjoxNjExNTkwOTkwfQ.NmQ-N0hqJaY4NtjGJdJm1XFlsozyt-tB4CYLdtL4QoM
Accept-Encoding: gzip

HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
Date: Mon, 25 Jan 2021 16:09:51 GMT
Content-Length: 64

{&quot;flag&quot;:&quot;sorry but you don't have access to this functionality&quot;}
</code></pre><h2 id=so-what-are-jwts-anyway>So what are JWTs anyway?</h2><blockquote><p>JSON Web Tokens are an open, industry standard RFC 7519 method for representing claims securely between two parties.</p></blockquote><p>They are frequently used in web applications where, after a client successfully authenticates, the server generates and sends a token that has the claim &ldquo;logged in as someusername&rdquo;. The client can then use the token to prove to the server that it has logged in correctly. These tokens can be signed using a private key (usually called secret) that the server can use to verify their authenticity.</p><p>Now that I had a token, I went to <a href=https://jwt.io/>jwt.io</a> to decode its claim. The content was:</p><pre><code>{
  &quot;exp&quot;: 1611594590,
  &quot;id&quot;: &quot;test&quot;,
  &quot;orig_iat&quot;: 1611590990
}
</code></pre><p>And it was signed using HMAC-SHA256.</p><h2 id=profit>Profit</h2><p>Up to this point, I knew that:</p><ul><li>The binary was an interface for an API.</li><li>Whenever a user authenticated, the API returned a JWT.</li><li>The JWT contained the username in the <code>id</code> field.</li><li>Authentication worked for any user but admin (I tried some more :P).</li><li>The token was verified by the server when I tried to retrieve the flag.</li></ul><p>It was reasonable to think that if I crafted a JWT claiming to be the admin I could get the flag. The only problem was that I didn&rsquo;t have the secret to sign it. Then, I remembered that the binary had the secret option that printed <code>0x41414141 is 1337</code>. It turned out that this was the private key used to sign the JWTs, so I crafted a new token claiming to be the admin and used it to get the flag:</p><pre><code>$ curl -H 'Accept: application/json' -H &quot;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2MTE1OTg0MDcsImlkIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTYxMTU5NDgwN30.-w7i7E_b5BsmVFZuMS4HTUtmKuWFzXVetbzTr9ywc9I&quot; http://161.97.176.150:6666/auth/flag
{&quot;flag&quot;:&quot;flag{3v3ry7h1ng_1s_ins3cure_:P}&quot;}
</code></pre><hr><h1 id=post-written-by-ogianatiempohttpstwittercomogianatiempo>Post written by <a href=https://twitter.com/ogianatiempo>@ogianatiempo</a></h1></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#first-impressions-and-reversing>First impressions and reversing</a></li><li><a href=#intercepting-network-traffic>Intercepting network traffic</a></li><li><a href=#so-what-are-jwts-anyway>So what are JWTs anyway?</a></li><li><a href=#profit>Profit</a></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f"><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&text=cliBrowser"><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&title=cliBrowser"><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&is_video=false&description=cliBrowser"><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=cliBrowser&body=Check out this article: https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f"><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&title=cliBrowser"><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&title=cliBrowser"><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&title=cliBrowser"><i class="fab fa-stumbleupon fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&title=cliBrowser"><i class="fab fa-digg fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&name=cliBrowser&description=First%20impressions%20and%20reversing%20This%20challenge%20consisted%20of%20a%20hint%3a%0a%20Man%20I%20am%20so%20tired%20of%20that%20cringe%20web%20stack%2c%20it%26rsquo%3bs%20such%20a%20joke.%20So%20I%20made%20my%20web%20app%20in%20the%20cli%2c%20because%20what%26rsquo%3bs%20better%20than%20fancy%20terminal%0a%20And%20a%20binary%20named%20client%20that%20upon%20execution%20printed%20a%20banner%20%28very%20cool%20btw%29%20and%20displayed%20a%20prompt.%0aI%20started%20by%20entering%20some%20random%20input%20and%20got%20back%20invalid%20input%20provided%2c%20so%20the%20logical%20step%20was%20to%20search%20for%20this%20string."><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-cli-browser%2f&t=cliBrowser"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu class=icon href=# onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden=true></i>Menu</a>
<a id=toc class=icon href=# onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden=true></i>TOC</a>
<a id=share class=icon href=# onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden=true></i>share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i>Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2021 fernetInjection</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script></html>