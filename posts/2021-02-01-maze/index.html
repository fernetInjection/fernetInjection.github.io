<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Maze | fernetInjection</title><meta name=description content="We are fernetInjection, a CTF team from Argentina ðŸ‡¦ðŸ‡·. Here you can find our write-ups and reflections."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Maze"><meta property="og:description" content="First impressions This challenge had the following description:
maze corparate just started a new trading platform, let's hope its secure because I got all my funds over there http://45.134.3.200:9000/ The URL provided us a web to hack with a simple login page:
The Login Form Our first attempt as hackers, is to always try common easy username-password combinations, but in this case they didn&rsquo;t work. We decided to proxy the requests this site was doing to understand its behaviour, everything looked pretty clean."><meta property="og:type" content="article"><meta property="og:url" content="https://fernetinjection.github.io/posts/2021-02-01-maze/"><meta property="article:published_time" content="2021-02-01T09:00:00+00:00"><meta property="article:modified_time" content="2021-02-01T09:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Maze"><meta name=twitter:description content="First impressions This challenge had the following description:
maze corparate just started a new trading platform, let's hope its secure because I got all my funds over there http://45.134.3.200:9000/ The URL provided us a web to hack with a simple login page:
The Login Form Our first attempt as hackers, is to always try common easy username-password combinations, but in this case they didn&rsquo;t work. We decided to proxy the requests this site was doing to understand its behaviour, everything looked pretty clean."><link rel=stylesheet href=https://fernetinjection.github.io/css/style-dark.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://fernetinjection.github.io/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a><a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a><a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast');" style=display:none><i class="fas fa-chevron-up fa-lg"></i></a><span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://fernetinjection.github.io/posts/2021-02-01-the-pwn-inn/><i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li><li><a class=icon href=https://fernetinjection.github.io/posts/2021-02-01-external/><i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li><li><a class=icon href=#><i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f"><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&text=Maze"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&title=Maze"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&is_video=false&description=Maze"><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Maze&body=Check out this article: https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f"><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&title=Maze"><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&title=Maze"><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&title=Maze"><i class="fab fa-stumbleupon" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&title=Maze"><i class="fab fa-digg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&name=Maze&description=First%20impressions%20This%20challenge%20had%20the%20following%20description%3a%0amaze%20corparate%20just%20started%20a%20new%20trading%20platform%2c%20let%27s%20hope%20its%20secure%20because%20I%20got%20all%20my%20funds%20over%20there%20http%3a%2f%2f45.134.3.200%3a9000%2f%20The%20URL%20provided%20us%20a%20web%20to%20hack%20with%20a%20simple%20login%20page%3a%0aThe%20Login%20Form%20Our%20first%20attempt%20as%20hackers%2c%20is%20to%20always%20try%20common%20easy%20username-password%20combinations%2c%20but%20in%20this%20case%20they%20didn%26rsquo%3bt%20work.%20We%20decided%20to%20proxy%20the%20requests%20this%20site%20was%20doing%20to%20understand%20its%20behaviour%2c%20everything%20looked%20pretty%20clean."><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&t=Maze"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#first-impressions>First impressions</a></li><li><a href=#the-login-form>The Login Form</a><ul><li><a href=#querying-graphql>Querying GraphQL</a></li></ul></li><li><a href=#the-product-list>The Product List</a><ul><li><a href=#sql-injection>SQL Injection</a></li><li><a href=#sql-injection-union-attack>SQL Injection UNION Attack</a></li></ul></li><li><a href=#the-admin-panel>The Admin Panel</a><ul><li><a href=#template-injection-attack>Template Injection Attack</a></li><li><a href=#rce-through-template-injection>RCE Through Template Injection</a></li></ul></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Maze</h1><div class=meta><div class=postdate><time datetime="2021-02-01 09:00:00 +0000 UTC" itemprop=datePublished>2021-02-01</time></div><div class=article-category><i class="fas fa-archive"></i><a class=category-link href=/categories/ctf>CTF</a></div><div class=article-tag><i class="fas fa-tag"></i><a class=tag-link href=/tags/web rel=tag>Web</a>
<a class=tag-link href=/tags/ctf_0x41414141 rel=tag>CTF_0x41414141</a>
<a class=tag-link href=/tags/exploitation rel=tag>Exploitation</a>
<a class=tag-link href=/tags/sqli rel=tag>SQLi</a>
<a class=tag-link href=/tags/template_injection rel=tag>Template_Injection</a></div></div></header><div class=content itemprop=articleBody><h2 id=first-impressions>First impressions</h2><p>This challenge had the following description:</p><pre><code>maze corparate just started a new trading platform, let's hope its secure because I got all my funds over there
http://45.134.3.200:9000/
</code></pre><p>The URL provided us a web to hack with a simple login page:</p><p><img src=../../images/posts/maze/00_login.png alt=output></p><h2 id=the-login-form>The Login Form</h2><p>Our first attempt as hackers, is to always try common easy username-password combinations, but in this case they didn&rsquo;t work. We decided to proxy the requests this site was doing to understand its behaviour, everything looked pretty clean. Our third instinctive thing to look at was to check what&rsquo;s in the <code>robots.txt</code>, this displayed something interesting:</p><pre><code>/sup3r_secr37_@p1
</code></pre><p>We went directly to this endpoint:</p><pre><code>http://45.134.3.200:9000/sup3r_secr37_@p1`
</code></pre><h3 id=querying-graphql>Querying GraphQL</h3><p><img src=../../images/posts/maze/01_graphql.png alt=output></p><p>This given GUI give us the possibility to go further querying our API through Graphql, the problem was that at the time we were doing the challenge we knew shit about it. So what could we do?</p><p>The GUI had a <code>Docs</code> section which we could use to learn more about it. If as we did you are wondering what exactly is GraphQL, we can define it as the following:</p><blockquote><p>GraphQL is a data query language developed by Facebook that was released in 2015. GraphQL acts as an alternative to REST APIs. Rest APIs require the client to send multiple requests to different endpoints of the API to query data from the backend database. With graphQL you only need to send one request to query the backend. This is a lot simpler because you donâ€™t have to send multiple requests to the API, a single request can be used to gather all the necessary information.</p></blockquote><p>We also discovered that by default GraphQL does not implement authentication, this is put on the developer to implement. This means by default graphQL allows anyone to query it, any sensitive information will be available to attackers unauthenticated.</p><p>We decided to explore the API just using <code>{}</code> for querying with the number 1, as a first attempt to understand its behaviour.</p><p><img src=../../images/posts/maze/02_query.png alt=output></p><p>The autocomplete function of the GUI suggested some useful queries available to execute. We decided to use <code>allTraders</code> and then press <code>Play</code>, these attributes included some other items to the query. In the end it looked like this:</p><p><img src=../../images/posts/maze/03_base64.png alt=output></p><p>We observed clearly that this was a <code>base64</code> encoded string, which decoded is <code>TraderObject:1</code>. This gave us the indication that the number <code>1</code> in our query could lead to something. Indeed, after using <code>1</code> and pressing enter after the id (in node) and pressing 1 again showed some more options.</p><p><img src=../../images/posts/maze/04_id.png alt=output></p><p>We added all of them to see where the query was pointing to. After a while adding data, our query looked like this:</p><p><img src=../../images/posts/maze/05_finalquery.png alt=output></p><p>We can observe that this is a username and a password (is not base64). We tried to login using <code>pop_eax</code> and <code>iigvj3xMVuSI9GzXhJJWNeI</code> as password. Didn&rsquo;t work, so we simply tried <code>XFT</code> as the username, and we were in.</p><h2 id=the-product-list>The Product List</h2><p>This view show us the classic product list that we normally could find in e-commerces or other sites structured alike:</p><p><img src=../../images/posts/maze/06_coins.png alt=output></p><p>If we observe the URL, a Trade endpoint exists. Which automatically gave us the indication that we would be able to try a <code>SQL Injection</code>. The endpoint queried the database using <code>trade?coin=eth%27</code>, so we started to try this attack with a classic <code>( 27==' )</code>. We received a <code>500 error</code> from the application, meaning that the database engine tried to run the query unsuccessfully. But we also tried adding <code>--</code>, syntax that serve us to comment all what comes next in the query, and we got the same page result as with <code>trade?coin=eth</code>. So we confirmed that there is a SQL injection vulnerability here.</p><h3 id=sql-injection>SQL Injection</h3><p>We started to map the database testing several times the kind of of output it was giving us each time we modified the query of the attack:</p><ul><li><p><code>/trade?coin=eth%27%20or%20false--</code> <strong>Returned the same result.</strong></p></li><li><p><code>/trade?coin=eth%27%20or%20true--</code> <strong>Returned XFT coin instead of Eth.</strong></p></li><li><p><code>/trade?coin=eth%27%20or%20true%20order%20by%201--</code> <strong>Returned BTC and we ordered results by the first column (1).</strong></p></li><li><p><code>/trade?coin=eth%27%20or%20true%20order%20by%202--</code> <strong>Returned XFT and we ordered results by the second column (2).</strong></p></li><li><p><code>/trade?coin=eth%27%20or%20true%20order%20by%203--</code> <strong>We ordered results by the third column (3) and returned <code>error 500</code>.</strong></p></li></ul><p>With this last try, we can interpret that there must be only 2 columns in current table.</p><ul><li><code>/trade?coin=eth%27%20union%20select%20%271%27,%272%27--</code> <strong>We tried to show constant values like 1 or 2.</strong></li></ul><p><img src=../../images/posts/maze/07_sqli.png alt=output></p><h3 id=sql-injection-union-attack>SQL Injection UNION Attack</h3><p>Once we knew the basics about our current table, we thought it would be nice to explore other database fields from the same and other tables. We decided to use an UNION attack this time, with the following attributes:</p><ul><li><code>/trade?coin=eth%27+UNION+SELECT%20title,body+from+coins--</code> <strong>We observed that there is a title and a body field in the table.</strong></li></ul><p><img src=../../images/posts/maze/08_xft.png alt=output></p><p>We figured out that there is a <code>coins</code>, an <code>admin</code> table and maybe others, but these were interesting enough to play with them first. So we ran a classic:</p><ul><li><code>/trade?coin=eth%27+UNION+SELECT%20username,password+from+admin--</code> <strong>And we got a password.</strong></li></ul><p><img src=../../images/posts/maze/09_admin.png alt=output></p><p>For more information about SQLi attacks, we recommend to check the <a href=https://portswigger.net/web-security/sql-injection>PortSwigger Academy exercises and documentation.</a></p><h2 id=the-admin-panel>The Admin Panel</h2><p>We tried to log in as <code>Admin</code> in the admin section with the credentials we retrieved: username <code>admin</code> and password <code>p0To3zTQuvFDzjhO9</code> we got into another view. At this point we understood that the meaning of the challenge name was no joke.</p><p><img src=../../images/posts/maze/10_dialog.png alt=output></p><p>So what can we do with a dialog like this?</p><blockquote><p>When no attacks come up to your mind easily, look at the source.</p></blockquote><p><img src=../../images/posts/maze/image-20210126195802389.png alt=output></p><p>We observed here that there are 2 scripts, a <code>css</code> file and a <code>javascript</code> variable <code>name</code> with value <code>skid</code>. Looking at <code>scripts.js</code> we saw that a global variable name is acceeded and appended to the message that was being animated in the dialog.</p><p><img src=../../images/posts/maze/11_globalvar.png alt=output></p><p>We decided to intercept the request, and noticed that a cookie was set with a value defined as <code>skid</code>.</p><p><img src=../../images/posts/maze/12_cookie.png alt=output></p><p>So we changed the cookie&rsquo;s name value to <code>fernetInjection</code> to see what happened, sending the request from Burp Proxy to Repeater, changing there the value and pressing send.</p><p><img src=../../images/posts/maze/13_fernetinj.png alt=output></p><p>The string we put in the cookie name&rsquo;s value is set as the value of the javascript&rsquo;s variable name.</p><p>At this point we decided to try several attacks, but a loved one by our Bug Bounty hunters from the team came up to our minds.</p><h3 id=template-injection-attack>Template Injection Attack</h3><p>We saw that appending <code>{{}}</code> to the name the server returned a <code>500 error</code>.</p><blockquote><p>The best way to confirm if there is a template injection vulnerability is to enter some simple math operation like <code>{{4*4}}</code> so when the server render this part of the code, the engine executes 4*4, giving us 16.</p></blockquote><p>Effectively, the engine took the value from the cookie and rendered it without any validation. With the help of this graph we discovered which template engine was being used:</p><p><img src=../../images/posts/maze/14_templateinj.png alt=output></p><p>And here we attempted the worst attack we could execute through this vulnerability: RCE through template injection.</p><h3 id=rce-through-template-injection>RCE Through Template Injection</h3><p>Googling &ldquo;<code>jinja2 rce"</code> we found a lot of valuable information in the following blog: <a href=https://www.onsecurity.io/blog/server-side-template-injection-with-jinja2/>https://www.onsecurity.io/blog/server-side-template-injection-with-jinja2/</a></p><p>We tried some of the payloads listed and probed that we could indeed execute them successfully. The following example tried to read <code>/etc/passwd</code> in the server:</p><p><img src=../../images/posts/maze/15_etcpasswd.png alt=output></p><p>So our flag.txt must be somewhere near. We simply decided to read that file from the same directory as our first approach, and we got:</p><p><img src=../../images/posts/maze/16_flag.png alt=output></p><p>We escaped the maze.</p><p><strong>Flag: flag{u_35c@p3d_7h3_m@z3_5ucc3ssfu77y9933}</strong></p><hr><h1 id=post-written-by-broodkillerhttpstwittercom_broodkiller_--encodedwitchhttpstwittercomencodedwitch>Post written by <a href=https://twitter.com/_BrOoDkIlLeR_>@BrOoDkIlLeR</a> & <a href=https://twitter.com/encodedwitch>@encodedwitch</a></h1></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#first-impressions>First impressions</a></li><li><a href=#the-login-form>The Login Form</a><ul><li><a href=#querying-graphql>Querying GraphQL</a></li></ul></li><li><a href=#the-product-list>The Product List</a><ul><li><a href=#sql-injection>SQL Injection</a></li><li><a href=#sql-injection-union-attack>SQL Injection UNION Attack</a></li></ul></li><li><a href=#the-admin-panel>The Admin Panel</a><ul><li><a href=#template-injection-attack>Template Injection Attack</a></li><li><a href=#rce-through-template-injection>RCE Through Template Injection</a></li></ul></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f"><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&text=Maze"><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&title=Maze"><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&is_video=false&description=Maze"><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Maze&body=Check out this article: https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f"><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&title=Maze"><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&title=Maze"><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&title=Maze"><i class="fab fa-stumbleupon fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&title=Maze"><i class="fab fa-digg fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&name=Maze&description=First%20impressions%20This%20challenge%20had%20the%20following%20description%3a%0amaze%20corparate%20just%20started%20a%20new%20trading%20platform%2c%20let%27s%20hope%20its%20secure%20because%20I%20got%20all%20my%20funds%20over%20there%20http%3a%2f%2f45.134.3.200%3a9000%2f%20The%20URL%20provided%20us%20a%20web%20to%20hack%20with%20a%20simple%20login%20page%3a%0aThe%20Login%20Form%20Our%20first%20attempt%20as%20hackers%2c%20is%20to%20always%20try%20common%20easy%20username-password%20combinations%2c%20but%20in%20this%20case%20they%20didn%26rsquo%3bt%20work.%20We%20decided%20to%20proxy%20the%20requests%20this%20site%20was%20doing%20to%20understand%20its%20behaviour%2c%20everything%20looked%20pretty%20clean."><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2ffernetinjection.github.io%2fposts%2f2021-02-01-maze%2f&t=Maze"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu class=icon href=# onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden=true></i>Menu</a>
<a id=toc class=icon href=# onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden=true></i>TOC</a>
<a id=share class=icon href=# onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden=true></i>share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i>Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2021 fernetInjection</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script></html>